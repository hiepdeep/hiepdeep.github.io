<!DOCTYPE html>
<html lang="vn">
	<head>
		<meta charset="UTF-8">
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
		<meta content="width=device-width, initial-scale=1" name="viewport">
		<base href="https://hiepdeep.github.io/">
		<link rel="icon" href="library/favicon/hiepdeep.ico">
		<title>Social Media | V1.0.0</title>
		<meta name="title" content="HiepDeep">
		<meta name="description" content="HiepDeep">
		<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
		<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
		<script src="library/script/config-firebase.js"></script>
		<script src="library/script/loading.js"></script>
		<link rel="stylesheet" href="library/style/oneforall.css">
		<link rel="stylesheet" href="library/style/loading.css">
		<link rel="stylesheet" href="ref/auth/auth.css">
	</head>
	<body>
		<div id="preloader">
			<svg viewbox="0 0 240 240">
				<circle cx="120" cy="120" r="90"></circle>
			</svg>
		</div>
		<div class="header">
			<div class="margin-block">
				<div class="logo">
					<a href="">
						<img src="library/pictures/svg/ui-deck.svg" alt="">
					</a>
				</div>
				<div class="header-right">
					<form id="login">
						<div class="input">
							<input type="text" name="username" placeholder="username">
						</div>
						<div class="input">
							<input type="password" name="password" placeholder="password">
						</div>
						<button type="submit">Đăng nhập</button>
					</form>
				</div>
			</div>
		</div>
		<div class="main">
			<div class="margin-block">
				<img src="library/pictures/svg/undraw_people_ka7y.svg" alt="">
				<form id="signup">
					<div class="row">
						<div class="input">
							<span class="material-icons">assignment_ind</span>
							<input tabindex="0" type="text" name="lname" placeholder="Họ">
						</div>
						<div class="input">
							<span class="material-icons">assignment_ind</span>
							<input tabindex="1" type="text" name="fname" placeholder="Tên">
						</div>
					</div>
					<div class="row">
						<div class="input">
							<span class="material-icons">cake</span>
							<input tabindex="2" type="text" name="birthday" placeholder="dd/mm/yyyy">
						</div>
						<input type="radio" name="sex" value="male" checked>
						<input type="radio" name="sex" value="female">
					</div>
					<div class="row">
						<div class="input">
							<span class="material-icons">how_to_reg</span>
							<input tabindex="3" type="text" name="username" placeholder="username">
						</div>
					</div>
					<div class="row">
						<div class="input">
							<span class="material-icons">password</span>
							<input tabindex="4" type="password" name="password" placeholder="password">
						</div>
					</div>
					<div class="row">
						<div class="input">
							<span class="material-icons">add_call</span>
							<input tabindex="5" type="text" name="phone" placeholder="0123456789">
						</div>
					</div>
					<div class="row">
						<div class="input">
							<span class="material-icons">alternate_email</span>
							<input tabindex="6" type="text" name="email" placeholder="abc@example.com">
						</div>
					</div>
					<button type="submit">Tạo tài khoản mới</button>
				</form>
			</div>
		</div>
		<script type="text/javascript">
			console.clear();
			const loggedInUser = localStorage.getItem("social-media-auth") ? window.atob(localStorage.getItem("social-media-auth")) : null;
			if (loggedInUser) {
				window.location.href = "https://hiepdeep.github.io";
			}
			else {
				const accounts = "authentication";
				let arrUsers = [];
				database.ref(accounts).on("value", (snapshot) => {
					if (snapshot.exists()) {
						let data = snapshot.val();
						let object_keys = Object.keys(data);
						arrUsers = object_keys;
					}
				});
				document.forms["login"].addEventListener("submit", function(event) {
					event.preventDefault();
					let username = document.forms["login"]["username"];
					let password = document.forms["login"]["password"];
					if (username.value.trim() && password.value.trim()) {
						if (arrUsers.includes(username.value.trim())) {
							database.ref(`${accounts}/${username.value.trim()}`).once("value", (snapshot) => {
								let data = snapshot.val();
								if (password.value.trim() === data.private.password) {
									localStorage.setItem("social-media-auth", data.userid);
									document.forms["login"].reset();
									window.location.href = "https://hiepdeep.github.io";
								} else {
									alert(`Sai mật khẩu.`);
									username.parentNode.classList.remove("error");
									password.parentNode.classList.add("error");
								}
							});
						} else {
							alert(`Không tìm thấy {${username.value.trim()}}. Hãy tạo tài khoản mới!`);
							username.parentNode.classList.add("error");
							password.parentNode.classList.remove("error");
						}
					} else {
						if (!username.value.trim()) {
							username.parentNode.classList.add("error");
						}
						else {
							username.parentNode.classList.remove("error");
						}
						if (!password.value.trim()) {
							password.parentNode.classList.add("error");
						}
						else {
							password.parentNode.classList.remove("error");
						}
					}
				});
				// document.forms["signup"].addEventListener("submit", function(event) {
				// 	event.preventDefault();
				// 	let lname = document.forms["signup"]["lname"].value;
				// 	let fname = document.forms["signup"]["fname"].value;
				// 	let birthday = document.forms["signup"]["birthday"].value;
				// 	let sex = document.forms["signup"]["sex"].value;
				// 	let username = document.forms["signup"]["username"].value;
				// 	let password = document.forms["signup"]["password"].value;
				// 	let phone = document.forms["signup"]["phone"].value;
				// 	let email = document.forms["signup"]["email"].value;
				// 	console.clear();
				// 	console.log({
				// 		lname: lname,
				// 		fname: fname,
				// 		birthday: birthday,
				// 		sex: sex,
				// 		username: username,
				// 		password: password,
				// 		phone: phone,
				// 		email: email,
				// 	});
				// 	localStorage.setItem("social-media-auth", window.btoa(username));
				// 	document.forms["signup"].reset();
				// 	window.location.href = "https://hiepdeep.github.io";
				// });
			}
		</script>
	</body>
</html>